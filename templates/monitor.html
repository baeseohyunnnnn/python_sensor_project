<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ì‹¤ì‹œê°„ í™˜ê²½ ëª¨ë‹ˆí„°ë§ ëŒ€ì‹œë³´ë“œ</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <style>
        body { font-family: 'Arial', sans-serif; background-color: #f4f7f6; margin: 0; padding: 20px; }
        .header { text-align: center; color: #2c3e50; margin-bottom: 20px; }
        /* ì„ê³„ê°’ í‘œì‹œ ì—…ë°ì´íŠ¸ */
        .threshold-info { text-align: center; color: #555; margin-bottom: 30px; line-height: 1.5; font-size: 1.1em; }
        .card-container { display: flex; justify-content: space-around; flex-wrap: wrap; margin-bottom: 30px; }
        .card {
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            padding: 20px;
            margin: 10px;
            width: 30%;
            min-width: 200px;
            text-align: center;
        }
        .card h3 { color: #34495e; margin-top: 0; }
        .card .value { font-size: 2.5em; font-weight: bold; margin: 10px 0; }
        .card .description { color: #7f8c8d; }
        .status-card { background-color: #ecf0f1; }
        
        /* ìƒíƒœë³„ ìƒ‰ìƒ í´ë˜ìŠ¤ */
        .alert-high { color: #e74c3c; } /* ê³ ì˜¨, ê³ ìŠµ */
        .alert-low { color: #3498db; }  /* ì €ì˜¨ */
        .alert-normal { color: #2ecc71; } /* ì •ìƒ */

        /* ìˆ˜ë™ ì…ë ¥ ê¸°ë¡ ìŠ¤íƒ€ì¼ */
        .manual-records-section h2 { color: #2c3e50; border-bottom: 2px solid #ddd; padding-bottom: 10px; margin-top: 30px; font-size: 1.4em;}
        .record-item {
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 5px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
            font-size: 0.95em;
        }
        /* ê²½ê³  ê¸°ë¡ì˜ ë°°ê²½ìƒ‰ */
        .record-alert { 
            background-color: #f8d7da; 
            border: 1px solid #f5c6cb; 
            color: #721c24; 
        }
        /* ì •ìƒ ê¸°ë¡ì˜ ë°°ê²½ìƒ‰ */
        .record-normal { 
            background-color: #d4edda; 
            border: 1px solid #c3e6cb; 
            color: #155724; 
        }
        .record-item strong { margin-right: 5px; font-weight: bold; }
    </style>
</head>
<body>

    <h1 class="header">ğŸ­ ì‹¤ì‹œê°„ í™˜ê²½ ëª¨ë‹ˆí„°ë§ ëŒ€ì‹œë³´ë“œ</h1>
    
    <div class="threshold-info">
        <p>
            **ì˜¨ë„ ê¸°ì¤€:** {{ LOW_TEMP_THRESHOLD }}Â°C ë¯¸ë§Œ (ì €ì˜¨) | 
            {{ HIGH_TEMP_THRESHOLD }}Â°C ì´ìƒ (ê³ ì˜¨)
        </p>
        <p>
            **ìŠµë„ ê¸°ì¤€:** {{ HIGH_HUM_THRESHOLD }}% ì´ìƒ (ê³ ìŠµ)
        </p>
    </div>

    <div style="text-align: center; margin-bottom: 30px;">
        <a href="{{ url_for('add_data_form') }}" style="display: inline-block; padding: 12px 25px; background-color: #f39c12; color: white; text-decoration: none; border-radius: 6px; font-weight: bold; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
            ìˆ˜ë™ìœ¼ë¡œ ë°ì´í„° ì…ë ¥í•˜ê¸°
        </a>
    </div>

    <div class="card-container">
        <div class="card">
            <h3>í˜„ì¬ ì˜¨ë„ (Â°C)</h3>
            <div id="temp-value" class="value">--</div>
            <p class="description">ì‹¤ì‹œê°„ ì„¼ì„œ ë°ì´í„°</p>
        </div>

        <div class="card">
            <h3>í˜„ì¬ ìŠµë„ (%)</h3>
            <div id="hum-value" class="value">--</div>
            <p class="description">ì‹¤ì‹œê°„ ì„¼ì„œ ë°ì´í„°</p>
        </div>

        <div class="card status-card">
            <h3>ì‹œìŠ¤í…œ ìƒíƒœ</h3>
            <div id="status-value" class="value">--</div>
            <p id="status-description" class="description">--</p>
        </div>
    </div>
    
    <div class="manual-records-section">
        <h2>ğŸ“ ìˆ˜ë™ ì…ë ¥ ê¸°ë¡ (ìµœì‹ ìˆœ)</h2>
        {% if manual_records %}
            {% for record in manual_records %}
            {% set alert_class = 'record-alert' if 'ê²½ê³ ' in record.alert_status else 'record-normal' %}
            <div class="record-item {{ alert_class }}">
                <strong>ì‹œê°„:</strong> {{ record.timestamp }} | 
                <strong>ì¥ì†Œ:</strong> {{ record.location }} | 
                <strong>ì˜¨ë„:</strong> {{ record.temperature }}Â°C | 
                <strong>ìŠµë„:</strong> {{ record.humidity }}% | 
                <span style="font-weight: bold;">
                    ìƒíƒœ: {{ record.alert_status }}
                </span>
            </div>
            {% endfor %}
        {% else %}
            <p>ì•„ì§ ìˆ˜ë™ìœ¼ë¡œ ì…ë ¥ëœ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</p>
        {% endif %}
    </div>

    <script>
        // AJAXë¥¼ ì´ìš©í•´ 1ì´ˆë§ˆë‹¤ ì‹¤ì‹œê°„ ë°ì´í„° ì—…ë°ì´íŠ¸
        function update_data() {
            $.getJSON("{{ url_for('get_data') }}", function(data) {
                // 1. ê°’ ì—…ë°ì´íŠ¸
                $("#temp-value").text(data.temperature.toFixed(2));
                $("#hum-value").text(data.humidity.toFixed(2));
                $("#status-value").text(data.status);
                $("#status-description").text(data.status === 'ì •ìƒ ë²”ìœ„' ? 'ëª¨ë“  í™˜ê²½ ìš”ì†Œ ì •ìƒ' : 'ì£¼ì˜ ìš”ë§');

                // 2. ìƒ‰ìƒ ë° ìŠ¤íƒ€ì¼ ì—…ë°ì´íŠ¸
                $("#status-value").removeClass("alert-high alert-low alert-normal");
                // ìƒíƒœ ë¬¸ìì—´ì— íŠ¹ì • ê²½ê³  í¬í•¨ ì—¬ë¶€ì— ë”°ë¼ ìƒ‰ìƒ ì§€ì •
                if (data.status.includes("ê³ ì˜¨") || data.status.includes("ê³ ìŠµ")) {
                    $("#status-value").addClass("alert-high");
                } else if (data.status.includes("ì €ì˜¨")) {
                    $("#status-value").addClass("alert-low");
                } else {
                    $("#status-value").addClass("alert-normal");
                }
                
                // ì˜¨ë„/ìŠµë„ ê°’ì— ë”°ë¥¸ ê°œë³„ ì¹´ë“œ ìƒ‰ìƒ ì—…ë°ì´íŠ¸
                var temp = data.temperature;
                $("#temp-value").removeClass("alert-high alert-low alert-normal");
                if (temp >= {{ HIGH_TEMP_THRESHOLD }}) {
                    $("#temp-value").addClass("alert-high");
                } else if (temp < {{ LOW_TEMP_THRESHOLD }}) {
                    $("#temp-value").addClass("alert-low");
                } else {
                    $("#temp-value").addClass("alert-normal");
                }

                var hum = data.humidity;
                $("#hum-value").removeClass("alert-high alert-normal");
                if (hum >= {{ HIGH_HUM_THRESHOLD }}) {
                    $("#hum-value").addClass("alert-high");
                } else {
                    $("#hum-value").addClass("alert-normal");
                }

            }).fail(function(jqXHR, textStatus, errorThrown) {
                 console.error("ë°ì´í„° ë¡œë“œ ì˜¤ë¥˜: " + textStatus + ", " + errorThrown);
                 $("#status-value").text("ì—ëŸ¬");
                 $("#status-description").text("ë°ì´í„° ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
            });
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì‹¤í–‰ ë° 1ì´ˆë§ˆë‹¤ ë°˜ë³µ
        $(document).ready(function() {
            update_data();
            setInterval(update_data, 1000); 
        });
    </script>
</body>
</html>